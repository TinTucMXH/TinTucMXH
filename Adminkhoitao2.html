<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản Trị Viên Tin Tức</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      padding: 20px;
      color: #1e3a8a;
    }
    h2 {
      text-align: center;
      color: #1e40af;
      margin-bottom: 20px;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .container {
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(30, 64, 175, 0.1);
      max-width: 560px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    label {
      font-weight: 600;
      color: #1e40af;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 15px;
    }
   input[type="text"], textarea {
      width: 100%;
      padding: 11px;
      border: 1.5px solid #90caf9;
      border-radius: 10px;
      font-size: 14px;
      transition: border 0.3s;
    }
    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: #42a5f5;
      box-shadow: 0 0 0 3px rgba(66, 165, 245, 0.2);
    }
    textarea { min-height: 90px; resize: vertical; }
    .input-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .input-group input { flex: 1; }
    .btn-small {
      padding: 8px 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: bold;
      transition: all 0.2s;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .btn-add { background: #42a5f5; color: white; }
    .btn-add:hover { background: #1e88e5; }
    .btn-remove { background: #ef5350; color: white; }
    .btn-remove:hover { background: #e53935; }
    .media-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      max-height: 180px;
      overflow-y: auto;
      padding: 8px;
      background: #f8fbff;
      border-radius: 10px;
      border: 1px dashed #90caf9;
    }
    .media-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px;
      background: #e3f2fd;
      border-radius: 8px;
      font-size: 13px;
      word-break: break-all;
    }
    .btn {
      width: 100%;
      padding: 13px;
      background: #1e88e5;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn:hover { background: #1565c0; }
    .btn-secondary { background: #42a5f5; }
    .btn-secondary:hover { background: #1e88e5; }
    #output, #outputtt {
      background: #f8fbff;
      font-family: monospace;
      font-size: 13px;
      line-height: 1.5;
    }
    .copy-hint {
      font-size: 12px;
      color: #42a5f5;
      text-align: center;
      margin-top: 4px;
      font-style: italic;
    }
    .popup {
      display: none;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center;
      z-index: 1000;
    }
    .popup-content {
      background: #fff;
      padding: 24px;
      border-radius: 16px;
      width: 90%;
      max-width: 360px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      text-align: center;
    }
    .popup input { margin-top: 12px; }
    .popup-buttons {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    .popup-buttons button {
      flex: 1;
      padding: 11px;
      border-radius: 10px;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .confirm { background: #42a5f5; color: white; }
    .confirm:hover { background: #1e88e5; }
    .cancel { background: #ef5350; color: white; }
    .cancel:hover { background: #e53935; }
    @media (max-width: 480px) {
      .container { padding: 16px; }
      h2 { font-size: 20px; }
    }
  </style>
</head>
<body>
  <h2>Quản Trị Viên Tin Tức MXH</h2>
  <div class="container">

    <!-- Tiêu đề -->
    <label for="a">Tiêu đề bài viết</label>
    <input type="text" id="a" placeholder="VD: Tai nạn giao thông tại Đề Gi">

    <!-- Nội dung -->
    <label for="ab">Nội dung chi tiết</label>
    <textarea id="ab" placeholder="Mô tả chi tiết sự kiện..."></textarea>

    <!-- Video (nhiều) -->
    <label>Link Google Drive video (nhiều)</label>
    <div class="input-group">
      <input type="text" id="videoInput" placeholder="Dán link chia sẻ từ Google Drive">
      <button class="btn-small btn-add" onclick="themVideo()" title="Thêm video">
        <i class="fas fa-plus"></i>
      </button>
    </div>
    <div class="media-list" id="videoList"></div>

    <!-- Ảnh chi tiết (nhiều) -->
    <label>Ảnh chi tiết (nhiều ảnh)</label>
    <div class="input-group">
      <input type="text" id="imageInput" placeholder="Dán link ảnh (Google Drive dùng uc?export=view)">
      <button class="btn-small btn-add" onclick="themAnh()" title="Thêm ảnh">
        <i class="fas fa-plus"></i>
      </button>
    </div>
    <div class="media-list" id="imageList"></div>

    <!-- Quảng cáo -->
    <label for="c">Link ảnh quảng cáo</label>
    <input list="videoAds" type="text" id="c" placeholder="Chọn hoặc nhập link ảnh">
    <datalist id="videoAds">
      <option value="https://tintucmxh.github.io/TinTucMXH/vn-11134258-820l4-mgug0poszr4b79.webp">Shopee Banner</option>
      <option value="https://tintucmxh.github.io/TinTucMXH/mbhtrungquyen.webp">Mũ Bảo Hiểm</option>
    </datalist>

    <label for="d">Link chuyển hướng quảng cáo</label>
    <input list="Ads" type="text" id="d" placeholder="Link Shopee, Tiki...">
    <datalist id="Ads">
      <!-- 12 link Shopee đã có -->
      <option value="https://s.shopee.vn/an_redir?origin_link=https%3A%2F%2Fshopee.vn%2Fproduct%2F642872908%2F26564042129%3Fgads_t_sig%3DVTJGc2RHVmtYMTlxTFVSVVRrdENkUm9yWVZMbGw0Q214S0d1TzNEZmUwNE9UTHo2Tmlza0JVKzdncFhxMXphcGxLOUkzNmJTODV4Q0JJajV2ZlM3VEQxR3RUU01TUEZwc1lyZCtlZkhXQ011RmVRTHBYZHlIanB5OFBvYXN2dXZKbW95Tmt5bHFLNkNLcks5Vk5iTW53PT0&sm=fb_partner&affiliate_id=17335420220">Link 1</option>
      <!-- ... (giữ nguyên 11 link còn lại) ... -->
      <option value="https://s.shopee.vn/an_redir?origin_link=https%3A%2F%2Fshopee.vn%2Fproduct%2F165690495%2F18374639660%3Fgads_t_sig%3DVTJGc2RHVmtYMTlxTFVSVVRrdENkUm9yWVZMbGw0Q214S0d1TzNEZmUwNUx1MXFvSTNKaGpBM2w3V3dlWXpsdHNvRlY5cVVGR3BMY0xaUHlVZWp5dDFla2FFUU5sOHEyYmZCYW1yQVpsc1NKWlo1QXp2N3lYMTJqZkdESEFLeGVreVdHVElJcDRCKy9rSjZWelNKZUdRPT0&sm=fb_partner&affiliate_id=17335420220">Link 12</option>
    </datalist>

    <!-- Buttons -->
    <button class="btn" onclick="xuatDuLieu()">Xuất Dữ Liệu</button>
    <button class="btn btn-secondary" onclick="hienPopup()">Lưu File HTML</button>
    <button class="btn btn-secondary" onclick="xemTruoc()">Xem Trước</button>

    <!-- Output -->
    <label>Thông tin tóm tắt (Click đúp để sao chép)</label>
    <textarea id="outputtt" readonly placeholder="Thông tin sẽ hiện ở đây..."></textarea>
    <div class="copy-hint">Click đúp để sao chép</div>

    <label>Mã HTML hoàn chỉnh (Click đúp để sao chép)</label>
    <textarea id="output" readonly placeholder="File HTML sẽ hiện ở đây..."></textarea>
    <div class="copy-hint">Click đúp để sao chép</div>

    <label>Đường dẫn trang web</label>
    <input type="text" id="linktrangwes" readonly placeholder="Sẽ hiển thị sau khi lưu">
  </div>

  <!-- Popup -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <h3>Nhập tên file</h3>
      <input type="text" id="fileName" placeholder="Tên file (không cần .html)">
      <div class="popup-buttons">
        <button class="confirm" onclick="xacNhanLuu()">Xác nhận</button>
        <button class="cancel" onclick="dongPopup()">Hủy</button>
      </div>
    </div>
  </div>

  <script>
    let danhSachVideo = [];
    let danhSachAnh = [];
    let tenFile = "";

    // === TỰ ĐỘNG CHUYỂN ĐỔI LINK ===
    function convertVideoLink(url) {
      const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
      return match ? `https://drive.google.com/file/d/${match[1]}/preview` : url;
    }

    function convertImageLink(url) {
      const match = url.match(/\/d\/([a-zA-Z0-9-_]+)/);
      return match ? `https://drive.google.com/uc?export=view&id=${match[1]}` : url;
    }

    // === VIDEO ===
    function themVideo() {
      const input = document.getElementById("videoInput");
      const url = input.value.trim();
      if (!url) return;
      const finalUrl = convertVideoLink(url);
      danhSachVideo.push(finalUrl);
      input.value = "";
      capNhatDanhSachVideo();
      xuatDuLieu();
    }

    function xoaVideo(index) {
      danhSachVideo.splice(index, 1);
      capNhatDanhSachVideo();
      xuatDuLieu();
    }

    function capNhatDanhSachVideo() {
      const list = document.getElementById("videoList");
      list.innerHTML = "";
      danhSachVideo.forEach((url, i) => {
        const div = document.createElement("div");
        div.className = "media-item";
        div.innerHTML = `
          <span>${i+1}. <i class="fas fa-video"></i> Video</span>
          <button class="btn-small btn-remove" onclick="xoaVideo(${i})" title="Xóa">
            <i class="fas fa-trash"></i>
          </button>
        `;
        list.appendChild(div);
      });
    }

    // === ẢNH ===
    function themAnh() {
      const input = document.getElementById("imageInput");
      const url = input.value.trim();
      if (!url) return;
      const finalUrl = convertImageLink(url);
      danhSachAnh.push(finalUrl);
      input.value = "";
      capNhatDanhSachAnh();
      xuatDuLieu();
    }

    function xoaAnh(index) {
      danhSachAnh.splice(index, 1);
      capNhatDanhSachAnh();
      xuatDuLieu();
    }

    function capNhatDanhSachAnh() {
      const list = document.getElementById("imageList");
      list.innerHTML = "";
      danhSachAnh.forEach((url, i) => {
        const div = document.createElement("div");
        div.className = "media-item";
        div.innerHTML = `
          <span>${i+1}. <i class="fas fa-image"></i> Ảnh</span>
          <button class="btn-small btn-remove" onclick="xoaAnh(${i})" title="Xóa">
            <i class="fas fa-trash"></i>
          </button>
        `;
        list.appendChild(div);
      });
    }

    // === TẠO HTML ===
    function taoFileHTML(tieude, noidung, adImg, adLink, tenFile) {
      const videoHTML = danhSachVideo.map(src => `
        <div class="video-container">
          <iframe src="${src}" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
      `).join('');

      const imageJS = danhSachAnh.map(src => `      { type: "image", src: "${src}" },`).join('\n');

      const html = [
  '<!DOCTYPE html>',
  '<html lang="vi">',
  '<head>',
  '  <meta charset="UTF-8">',
  `  <title>${tenFile}</title>`,
  '  <meta name="viewport" content="width=device-width, initial-scale=1.0">',
  '  <style>',
  '    * { box-sizing: border-box; margin: 0; padding: 0; }',
  '    body { font-family: Arial, sans-serif; background: #f5f6f7; }',
  '    header { background: #222; color: #fff; padding: 12px 18px; }',
  '    nav a { color: #fff; margin-right: 12px; text-decoration: none; font-weight: bold; }',
  '    main { max-width: 900px; margin: 20px auto; padding: 0 16px; }',
  '    article { background: #fff; padding: 16px; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); margin-bottom: 20px; }',
  '    footer { text-align: center; padding: 12px; background: #222; color: #fff; margin-top: 18px; }',
  '    .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; margin-top: 12px; background: #000; }',
  '    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }',
  '    .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-top: 12px; }',
  '    .gallery img { width: 100%; height: 100px; object-fit: cover; border-radius: 6px; cursor: pointer; transition: transform 0.2s; }',
  '    .gallery img:hover { transform: scale(1.05); }',
  '    .lightbox { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; justify-content: center; align-items: center; padding: 20px; }',
  '    .lightbox img { max-width: 90%; max-height: 90%; border-radius: 8px; }',
  '    .lightbox.active { display: flex; }',
  '    .popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 340px; background: #fff; box-shadow: 0 6px 25px rgba(0,0,0,0.25); border-radius: 14px; text-align: center; z-index: 9999; padding: 18px; display: none; animation: popupFadeIn 0.4s ease-out; }',
  '    @keyframes popupFadeIn { from { opacity: 0; transform: translate(-50%, -60%); } to { opacity: 1; transform: translate(-50%, -50%); } }',
  '    .popup h3 { margin: 0 0 8px; font-size: 18px; color: #d32f2f; }',
  '    .popup p { margin: 0 0 12px; font-size: 14px; color: #555; }',
  '    .popup img { width: 100%; max-height: 200px; object-fit: contain; border-radius: 10px; cursor: pointer; transition: transform 0.2s; }',
  '    .popup img:hover { transform: scale(1.02); }',
  '    .close-btn { position: absolute; top: 8px; right: 8px; background: #f44336; color: #fff; border: none; border-radius: 50%; width: 28px; height: 28px; cursor: pointer; font-weight: bold; font-size: 16px; line-height: 26px; }',
  '  </style>',
  '</head>',
  '<body>',
  '  <header><h1>Tin Tức Mạng Xã Hội</h1><nav><a href="index.html">Trang chủ</a><a href="news.html">Tin tức</a><a href="about.html">Giới thiệu</a></nav></header>',
  '  <main><article>',
  '    <h2>' + tieude + '</h2>',
  '    <p>' + noidung.replace(/\n/g, '<br>') + '</p>',
  videoHTML,
  '    <div id="mediaContainer"></div>',
  '  </article></main>',
  '  <footer>© 2025 Tin Tức 24h</footer>',
  '  <div class="lightbox" id="lightbox"><img id="lightboxImg" src="" alt=""></div>',
  '  <div class="popup" id="adPopup">',
  '    <button class="close-btn" id="closePopup">×</button>',
  '    <h3>Khuyến mãi đặc biệt!</h3>',
  '    <p>Nhấn vào ảnh để xem chi tiết.</p>',
  '    <img id="adImage" src="' + adImg + '" alt="QC">',
  '  </div>',
  '  <script>',
  '    const adLink = "' + adLink + '";',
  '    const mediaItems = [' + (imageJS ? '\n' + imageJS : '') + '];',
  '    window.onload = () => {',
  '      const container = document.getElementById("mediaContainer");',
  '      const lightbox = document.getElementById("lightbox");',
  '      const lightboxImg = document.getElementById("lightboxImg");',
  '      const popup = document.getElementById("adPopup");',
  '      const adImage = document.getElementById("adImage");',
  '      const closePopup = document.getElementById("closePopup");',
  '      if (mediaItems.length > 0) {',
  '        const g = document.createElement("div"); g.className = "gallery"; container.appendChild(g);',
  '        mediaItems.forEach(item => {',
  '          const img = document.createElement("img"); img.src = item.src;',
  '          img.onclick = () => { lightboxImg.src = item.src; lightbox.classList.add("active"); };',
  '          g.appendChild(img);',
  '        });',
  '      }',
  '      lightbox.onclick = () => lightbox.classList.remove("active");',
  '      adImage.onclick = () => { window.open(adLink, "_blank"); hidePopup(); };',
  '      closePopup.onclick = hidePopup;',
  '      let t; function showPopup() { popup.style.display = "block"; t = setTimeout(() => { window.open(adLink, "_blank"); hidePopup(); }, 5000); }',
  '      function hidePopup() { clearTimeout(t); popup.style.display = "none"; setTimeout(showPopup, 30000); }',
  '      setTimeout(showPopup, 2000);',
  '    };',
  '  <\/script>',
  '</body></html>'
      ];
      return html.join('\n');
    }

    // === XUẤT DỮ LIỆU ===
    function xuatDuLieu() {
      const a = document.getElementById("a").value.trim();
      const ab = document.getElementById("ab").value.trim();
      const c = document.getElementById("c").value.trim() || "https://via.placeholder.com/300x200?text=QC";
      const d = document.getElementById("d").value.trim() || "#";

      if (!a || !ab || danhSachVideo.length === 0) {
        alert("Vui lòng nhập tiêu đề, nội dung và ít nhất 1 video!");
        return;
      }

      tenFile = document.getElementById("fileName").value.trim() || a.replace(/[^a-zA-Z0-9]/g, '-');
      const html = taoFileHTML(a, ab, c, d, tenFile);
      const info = `Tiêu đề: ${a}\nVideo: ${danhSachVideo.length}\nẢnh: ${danhSachAnh.length}\nQC: ${c}`;

      document.getElementById("output").value = html;
      document.getElementById("outputtt").value = info;
    }

    // Click đúp sao chép
    ["outputtt", "output"].forEach(id => {
      document.getElementById(id).ondblclick = function() {
        this.select();
        document.execCommand("copy");
        alert("Đã sao chép!");
      };
    });

    function xemTruoc() {
      xuatDuLieu();
      const blob = new Blob([document.getElementById("output").value], { type: "text/html" });
      const win = window.open(URL.createObjectURL(blob), "_blank");
      win.document.title = tenFile;
    }

    function hienPopup() { document.getElementById("popup").style.display = "flex"; }
    function dongPopup() { document.getElementById("popup").style.display = "none"; document.getElementById("fileName").value = ""; }

    function xacNhanLuu() {
      const ten = document.getElementById("fileName").value.trim() || document.getElementById("a").value.trim().replace(/[^a-zA-Z0-9]/g, '-');
      if (!ten) return alert("Vui lòng nhập tên file!");
      xuatDuLieu();
      const blob = new Blob([document.getElementById("output").value], { type: "text/html;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = ten + ".html";
      link.click();
      document.getElementById("linktrangwes").value = "https://tintucmxh.github.io/TinTucMXH/" + ten + ".html";
      dongPopup();
    }

    // Enter để thêm
    ["videoInput", "imageInput"].forEach(id => {
      document.getElementById(id).addEventListener("keypress", e => {
        if (e.key === "Enter") e.target.nextElementSibling.onclick();
      });
    });
  </script>
</body>
</html>
