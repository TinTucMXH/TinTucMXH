<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grok → Facebook Post + Đọc To</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    :root {
      --primary: #1e88e5;
      --success: #43a047;
      --bg: #f8fbff;
      --card: #ffffff;
      --text: #1a1a1a;
      --border: #90caf9;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      color: var(--text);
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background: var(--card);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(30, 64, 175, 0.15);
      overflow: hidden;
    }
    header {
      background: var(--primary);
      color: white;
      padding: 18px;
      text-align: center;
      font-size: 20px;
      font-weight: 600;
    }
    .main {
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    label {
      font-weight: 600;
      color: #1565c0;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 15px;
    }
    textarea, #output {
      width: 100%;
      padding: 14px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s;
      resize: vertical;
      min-height: 120px;
    }
    textarea:focus, #output:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(30, 137, 229, 0.2);
    }
    #output {
      background: #f0f8ff;
      cursor: text;
      white-space: pre-wrap;
      line-height: 1.7;
    }
    .btn {
      padding: 12px 20px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: 0.3s;
      align-self: flex-start;
    }
    .btn:hover {
      background: #1565c0;
      transform: translateY(-2px);
    }
    .btn-success {
      background: var(--success);
    }
    .btn-success:hover {
      background: #2e7d32;
    }
    .btn-stop {
      background: #ef5350;
    }
    .btn-stop:hover {
      background: #e53935;
    }
    .copy-hint {
      font-size: 13px;
      color: #42a5f5;
      text-align: center;
      font-style: italic;
      margin-top: 4px;
    }
    .hashtags {
      font-size: 13px;
      color: #2e7d32;
      background: #e8f5e8;
      padding: 8px 12px;
      border-radius: 8px;
      margin-top: 8px;
      display: inline-block;
    }
    /* Tính năng Đọc To */
    .tts-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      padding: 12px;
      background: #f0f8ff;
      border-radius: 12px;
      border: 1px solid var(--border);
    }
    .tts-controls select, .tts-controls input {
      padding: 8px 12px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
    }
    .tts-controls select {
      flex: 1;
      min-width: 180px;
    }
    .tts-controls input[type="range"] {
      flex: 1;
    }
    .tts-status {
      font-size: 13px;
      color: #1565c0;
      font-style: italic;
      margin-top: 4px;
    }
    footer {
      text-align: center;
      padding: 16px;
      font-size: 13px;
      color: #666;
      border-top: 1px solid #eee;
    }
    @media (max-width: 480px) {
      .main { padding: 16px; }
      header { font-size: 18px; }
      .tts-controls { flex-direction: column; align-items: stretch; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <i class="fas fa-robot"></i> Grok → Bài Đăng Facebook + Đọc To
    </header>
    <div class="main">
      <div>
        <label for="input"><i class="fas fa-paste"></i> Dán nội dung từ Grok</label>
        <textarea id="input" placeholder="Dán toàn bộ nội dung trả lời từ Grok vào đây..."></textarea>
      </div>

      <button class="btn" onclick="convertContent()">
        <i class="fas fa-arrow-down"></i> Chuyển Đổi Ngay
      </button>

      <div>
        <label for="output"><i class="fas fa-check-circle"></i> Bài đăng Facebook (Sẵn sàng đăng)</label>
        <div id="output" contenteditable="false">Kết quả sẽ hiện ở đây...</div>
        <div class="copy-hint">Click đúp để sao chép toàn bộ</div>
      </div>

      <!-- TÍNH NĂNG ĐỌC TO MỚI -->
      <div class="tts-controls" id="ttsControls" style="display:none;">
        <select id="voiceSelect"></select>
        <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1">
        <span id="rateValue">1x</span>
        <button class="btn" onclick="speak()" id="playBtn">
          <i class="fas fa-play"></i> Đọc
        </button>
        <button class="btn btn-stop" onclick="stopSpeaking()" id="stopBtn" style="display:none;">
          <i class="fas fa-stop"></i> Dừng
        </button>
      </div>
      <div class="tts-status" id="ttsStatus"></div>

      <div id="hashtagBox" class="hashtags" style="display:none;"></div>
    </div>
    <footer>
      Được tạo bởi <b>Chuyên gia Code</b> • An toàn 100% với Facebook
    </footer>
  </div>

  <script>
    // Danh sách từ cấm
    const bannedWords = [
      'kiếm tiền online', 'làm giàu nhanh', 'kiếm tiền tại nhà', 'bí quyết kiếm tiền',
      'đầu tư sinh lời', 'kiếm tiền miễn phí', 'bot tự động', 'hack', 'crack',
      'sex', 'gái xinh', '18+', 'xxx', 'viagra', 'thuốc lắc', 'cờ bạc', 'casino'
    ];
    const commonHashtags = [
      '#TinTuc', '#SucKhoe', '#GiaoDuc', '#CongNghe', '#AmThuc',
      '#DuLich', '#TheThao', '#KhoaHoc', '#MoiTruong', '#VanHoa'
    ];

    let finalPostContent = '';
    let voices = [];
    let synth = window.speechSynthesis;
    let utterance = null;

    // === CHUYỂN ĐỔI NỘI DUNG ===
    function convertContent() {
      const raw = document.getElementById('input').value.trim();
      if (!raw) {
        alert('Vui lòng dán nội dung từ Grok!');
        return;
      }

      let title = '';
      const lines = raw.split('\n').map(l => l.trim());
      for (let line of lines) {
        if (line && (line.startsWith('**') || line.includes('#') || line.length > 20)) {
          title = line.replace(/\*\*/g, '').replace(/#/g, '').trim();
          break;
        }
      }
      if (!title && lines[0]) title = lines[0].slice(0, 80);

      let content = raw
        .replace(/(\*\*|__|\#|\`)/g, '')
        .replace(/\n{3,}/g, '\n\n')
        .replace(/https?:\/\/[^\s]+/g, '[Link]')
        .trim();

      bannedWords.forEach(word => {
        const regex = new RegExp(word, 'gi');
        content = content.replace(regex, '***');
      });

      const shortContent = content.split('\n').slice(0, 3).join('\n').trim();
      const finalContent = shortContent || content.slice(0, 300) + '...';

      const keywords = extractKeywords(finalContent);
      const smartTags = keywords.slice(0, 3).map(k => '#' + k);
      const hashtags = [...new Set([...smartTags, ...commonHashtags.slice(0, 2)])].join(' ');

      finalPostContent = `${title}\n\n${finalContent}\n\n${hashtags}`;
      document.getElementById('output').textContent = finalPostContent;
      document.getElementById('output').contentEditable = false;

      document.getElementById('hashtagBox').textContent = hashtags;
      document.getElementById('hashtagBox').style.display = 'block';

      // HIỂN THỊ TÍNH NĂNG ĐỌC TO
      document.getElementById('ttsControls').style.display = 'flex';
      loadVoices();

      // Click đúp copy
      document.getElementById('output').ondblclick = function() {
        const range = document.createRange();
        range.selectNode(this);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        window.getSelection().removeAllRanges();
        alert('Đã sao chép bài đăng!');
      };
    }

    function extractKeywords(text) {
      const stopWords = ['là', 'và', 'của', 'trong', 'với', 'tại', 'đã', 'có', 'được', 'không', 'để', 'một', 'nhiều'];
      return text
        .toLowerCase()
        .replace(/[^\p{L}\s]/gu, '')
        .split(/\s+/)
        .filter(word => word.length > 3 && !stopWords.includes(word))
        .slice(0, 5);
    }

    // === TÍNH NĂNG ĐỌC TO ===
    function loadVoices() {
      voices = synth.getVoices();
      const voiceSelect = document.getElementById('voiceSelect');
      voiceSelect.innerHTML = '';

      // Ưu tiên giọng Việt Nam
      const viVoices = voices.filter(v => v.lang.includes('vi'));
      const preferred = viVoices.find(v => v.name.includes('Google') || v.name.includes('Microsoft')) || viVoices[0];

      voices.forEach((voice, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `${voice.name} (${voice.lang})`;
        if (voice === preferred) option.selected = true;
        voiceSelect.appendChild(option);
      });

      if (viVoices.length === 0) {
        document.getElementById('ttsStatus').textContent = 'Không tìm thấy giọng tiếng Việt. Dùng giọng mặc định.';
      }
    }

    function speak() {
      if (!finalPostContent) return alert('Chưa có nội dung để đọc!');

      stopSpeaking();
      utterance = new SpeechSynthesisUtterance(finalPostContent);

      const voiceIndex = document.getElementById('voiceSelect').value;
      utterance.voice = voices[voiceIndex];
      utterance.rate = parseFloat(document.getElementById('rate').value);
      utterance.pitch = 1;

      utterance.onstart = () => {
        document.getElementById('playBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'flex';
        document.getElementById('ttsStatus').textContent = 'Đang đọc...';
      };

      utterance.onend = () => {
        document.getElementById('playBtn').style.display = 'flex';
        document.getElementById('stopBtn').style.display = 'none';
        document.getElementById('ttsStatus').textContent = 'Đã đọc xong!';
      };

      utterance.onerror = () => {
        document.getElementById('ttsStatus').textContent = 'Lỗi phát âm thanh.';
      };

      synth.speak(utterance);
    }

    function stopSpeaking() {
      synth.cancel();
      document.getElementById('playBtn').style.display = 'flex';
      document.getElementById('stopBtn').style.display = 'none';
      document.getElementById('ttsStatus').textContent = '';
    }

    // Cập nhật tốc độ
    document.getElementById('rate').addEventListener('input', function() {
      document.getElementById('rateValue').textContent = this.value + 'x';
    });

    // Tải giọng khi sẵn sàng
    if (synth.onvoiceschanged !== undefined) {
      synth.onvoiceschanged = loadVoices;
    }

    // Enter để chuyển đổi
    document.getElementById('input').addEventListener('keydown', e => {
      if (e.key === 'Enter' && e.ctrlKey) convertContent();
    });
  </script>
</body>
</html>
